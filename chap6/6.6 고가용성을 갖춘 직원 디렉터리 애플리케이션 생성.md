## 고가용성을 갖춘 직원 디렉터리 애플리케이션 생성

### 📌 AWS 로드 밸런싱 & 자동 크기 조정 연습 정리
#### 1. 인스턴스 준비

- **employee-directory-app-dynamodb** 인스턴스를 기반으로 새 인스턴스 시작

- 이름을 **employee-directory-app-lb** 로 변경 (로드 밸런싱 실습용)

- 퍼블릭 IP 활성화, 인스턴스 역할(User data 포함) 확인 후 시작

- 새 인스턴스가 정상 실행되면 애플리케이션이 기존 S3 버킷과 DynamoDB 테이블을 잘 불러오는지 확인

---

#### 2. Application Load Balancer(ALB) 생성

1. **로드 밸런서 유형 선택** → Application Load Balancer(ALB)

2. **이름** → app-elb

3. **인터넷 연결**(Internet-facing) 설정

4. **네트워크 매핑** → app-vpc, AZ 2개(us-west-2a, us-west-2b) 선택, 퍼블릭 서브넷 지정

5. **보안 그룹** → load-balancer-sg (포트 80 HTTP Anywhere 허용)

6. **대상 그룹 생성 (app-target-group)**

    - 대상 유형: Instances

    - 상태 확인(Health Check): Healthy=2, Unhealthy=5, Timeout=30s, Interval=40s

7. **대상 인스턴스 등록** → -lb 인스턴스 포함

8. **로드 밸런서 생성 후 DNS 이름 확인** → 브라우저 접속 → 앱 정상 동작 확인

---

#### 3. Launch Template 생성

- 이름: app-launch-template

- 설명: "직원 디렉터리 애플리케이션 웹 서버"

- 인스턴스 유형: t2.micro

- VPC/보안 그룹: app-vpc + web security group

- IAM 역할 포함 (S3, DynamoDB 접근)

- 사용자 데이터에 S3 버킷 & 리전(us-west-2) 맞게 수정

---

#### 4. Auto Scaling Group 생성

1. 이름: app-asg

2. 시작 템플릿: app-launch-template 선택

3. 네트워크: app-vpc → Public Subnet 1 & 2 선택

4. 로드 밸런서 연결: 기존 app-elb → 대상 그룹 app-target-group

5. 그룹 크기:

    - Desired capacity = 2

    - Minimum capacity = 2

    - Maximum capacity = 4

6. 크기 조정 정책(Target tracking scaling policy):

    - 평균 CPU 사용률(Target value) = 60%

    - 인스턴스 워밍업 시간 = 300초

---

#### 5. 테스트 (Stress CPU)

- 애플리케이션 /info 페이지 → **Stress CPU** 버튼으로 CPU 60% 이상 부하 발생

- CloudWatch 경보가 트리거 → Auto Scaling 그룹에서 인스턴스 자동 추가

- **결과**:

    - 인스턴스가 2개에서 4개까지 자동 확장

    - ALB 대상 그룹(Targets)에서 새 인스턴스 정상 상태 확인 가능

    - 시간이 지나 부하 감소 → 불필요한 인스턴스 자동 종료 → 다시 최소 용량(2)으로 유지

---

#### ✅ 핵심 포인트

- **ALB** → 트래픽을 여러 인스턴스로 분산

- **Auto Scaling 그룹** → CPU 사용률 기준으로 인스턴스를 자동 확장/축소

- **High Availability(고가용성**) → 여러 AZ에 분산 배치

- **비용 효율성** → 필요한 만큼만 자동 실행 & 종료

---

👉 이렇게 하면 운영자가 수동으로 인스턴스를 추가/삭제하지 않아도 되고, 사용량에 따라 시스템이 **자동으로 안정성과 확장성을 확보**하게 됩니다.